{% extends "base.html" %}

{% block title %}
Histórico de Pedidos
{% endblock %}

{% block header %}
<h1>Histórico de Pedidos</h1>
{% endblock %}

{% block content %}
<section>
    <h2>Seu Histórico de Pedidos, {{ user.get_full_name|default:user.username }}</h2>

    {% if pedidos %}
        <ul class="list-group">
            {% for pedido in pedidos %}
                <li class="list-group-item mb-3">
                    <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1">Pedido #{{ pedido.id }}</h5>
                        <small>{{ pedido.data_pedido|date:"d/m/Y H:i" }}</small>
                    </div>
                    <p class="mb-1">
                        <strong>Status:</strong> <span class="badge bg-info text-dark">{{ pedido.get_status_display }}</span> | 
                        <strong>Total: R$ {{ pedido.valor_total|floatformat:2 }}</strong> | 
                        <strong>Pagamento:</strong> {{ pedido.get_pagamento_display }}
                    </p>
                    <ul class="list-unstyled mt-2">
                        {% for item in pedido.itens.all %}
                            <li>- {{ item.quantidade }}x {{ item.produto.nome }}</li>
                        {% endfor %}
                    </ul>
                    {% if pedido.status == 'aberto' or pedido.status == 'pendente' %}
                        <!-- Não há ações de edição para o aluno aqui, apenas visualização do status. -->
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Você ainda não fez nenhum pedido.</p>
    {% endif %}

    <br>
    <a href="{% url 'painel_usuario' %}">Voltar ao Painel</a>
</section>
{% endblock %}

{% block footer %}
<p>© 2025 Cantina do Aluno</p>
{% endblock %}